1-first install drizzle

# Install Drizzle ORM and Neon driver
npm install drizzle-orm @neondatabase/serverless

# Install Drizzle Kit for migrations (dev dependency)
npm install -D drizzle-kit

# Install dotenv for environment variables
npm install dotenv

explnation:
â”‚ drizzle-orm          â†’  Type-safe database queries                
â”‚                          (like Prisma but lighter & faster)        
â”‚                                                                     
â”‚  @neondatabase/       â†’  Serverless PostgreSQL driver              
â”‚  serverless              (optimized for edge/serverless)           
â”‚                                                                     
â”‚  drizzle-kit          â†’  CLI tool for migrations           



2-put neon conntection in env file(put in .gitignore)




3-create database schema file you knwo the two coonetcion type you shoold do
# Create a new file at ./db/schema.ts
# Define your database schema using Drizzle ORM
  add this to packege.json

{
  "scripts": {
    "dev": "next dev",
    "build": "next build",
    "start": "next start",
    "lint": "next lint",
    
    "db:generate": "drizzle-kit generate",
    "db:push": "drizzle-kit push",
    "db:studio": "drizzle-kit studio",
    "db:migrate": "drizzle-kit migrate"
  }
}



4-run scripts of drieele
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           DATABASE SCRIPTS                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  npm run db:generate  â†’  Creates SQL migration files from schema changes   â”‚
â”‚                          (Run after changing schema.ts)                     â”‚
â”‚                                                                             â”‚
â”‚  npm run db:push      â†’  Pushes schema directly to DB (dev only!)          â”‚
â”‚                          Faster for development, no migration files        â”‚
â”‚                                                                             â”‚
â”‚  npm run db:studio    â†’  Opens browser UI to view/edit database            â”‚
â”‚                          Like phpMyAdmin but for Drizzle                   â”‚
â”‚                                                                             â”‚
â”‚  npm run db:migrate   â†’  Runs pending migrations in production             â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

run :npm run db:push //to push the schema to the database in development

for see your database in browser run : npm run db:studio


5-now clerk 

just follow the clerk nextjs instruction to install it and connect it with your database using drizzle orm

your env is shold like this:
# .env.local - Add these to your existing file

# ===========================================
# CLERK AUTHENTICATION
# ===========================================

# Public key (safe to expose to browser)
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_xxxxxxxxxxxxxxxx

# Secret key (NEVER expose this!)
CLERK_SECRET_KEY=sk_test_xxxxxxxxxxxxxxxx



# ===========================================
# CLERK ROUTES
# ===========================================

# Where to redirect after sign in/up
NEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in
NEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up
NEXT_PUBLIC_CLERK_AFTER_SIGN_IN_URL=/dashboard
NEXT_PUBLIC_CLERK_AFTER_SIGN_UP_URL=/dashboard


then setup clerk provider in layout.tsx as the clerk instruction

if you wwant make folder (auth) that contain all auth related page like sign in sign up and etc like layout for auth pages


then create midlleware.ts file in the root directory as the clerk instruction

then protect your route using the withAuth HOC from clerk in your page .
  

now cretae sign in and sign up page using the clerk components as the clerk instruction


now we create Simple User Sync Function (THE KEY PART!)=>src/lib/users.ts
that helper function names(name of files is user.ts and is inside lib folder in src):
export async function getOrCreateUser() {}
export async function getUserWithHabits() {}
then we create simple dashbord page that show today habit ... but is simple is step 3 and 4 we update it to show habit based on date selected and week overview



step 3:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         CRUD OPERATIONS                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  CREATE    â†’  Form to add new habits                                        â”‚
â”‚  READ      â†’  List all habits, view single habit                            â”‚
â”‚  UPDATE    â†’  Edit habit details                                            â”‚
â”‚  DELETE    â†’  Remove habits (soft delete with isActive)                     â”‚
â”‚                                                                             â”‚
â”‚  We'll use SERVER ACTIONS (Next.js 14 way)                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                  â”‚
â”‚  WHY Server Actions instead of API routes?                                  â”‚
â”‚  âœ… Less boilerplate code                                                   â”‚
â”‚  âœ… Type-safe from form to database                                         â”‚
â”‚  âœ… No need to create separate API files                                    â”‚
â”‚  âœ… Built-in form handling with useFormState                                â”‚
â”‚  âœ… Works with progressive enhancement (no JS needed)                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜



src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ (dashboard)/
â”‚       â””â”€â”€ dashboard/
â”‚           â”œâ”€â”€ page.tsx                    # Updated dashboard
â”‚           â””â”€â”€ habits/
â”‚               â”œâ”€â”€ page.tsx                # Habits list that fetches & displays habits
â”‚               â”œâ”€â”€ new/
â”‚               â”‚   â””â”€â”€ page.tsx            # Create habit form that when you wnat to create new habit
â”‚               â””â”€â”€ [id]/
â”‚                   â”œâ”€â”€ page.tsx            # View/Edit habit details(single habit)
â”‚                   â””â”€â”€ edit/
â”‚                       â””â”€â”€ page.tsx        # Edit form when is update or edit habit
â”œâ”€â”€ components/
â”‚   â””â”€â”€ habits/     #thta have component related to habit
â”‚       â”œâ”€â”€ habit-form.tsx                  # Reusable form component
â”‚       â”œâ”€â”€ habit-card.tsx                  # Habit display card
â”‚       â””â”€â”€ delete-habit-button.tsx         # Delete with confirmation
â””â”€â”€ lib/
    â””â”€â”€ actions/
        â””â”€â”€ habits.ts                       # Server actions for CRUD



1-first step is step(3) is create action (server action) that handle CRUD operation for habit (src/lib/actions/habits.ts)

function validateHabit(data: HabitFormData): Record<string, string[]> {}




export async function createHabit(formData: FormData): Promise<ActionResponse> {}


export async function getHabits() {}

export async function getHabitWithLogs(habitId: string) {}


export async function updateHabit(
  habitId: string,
  formData: FormData
): Promise<ActionResponse> {}



export async function deleteHabit(habitId: string): Promise<ActionResponse> {}




habitForm is for create and edit habit so we make it reusable form component that accept action as prop that is either createHabit or updateHabit function from src/lib/actions/habits.ts


habit-card.tsx is to show each habit in card view



delete-habit-button.tsx is a button with confirmation dialog to delete habit



src/app/(dashboard)/dashboard/habits/page.tsx is the habit list page that fetch and show all habit using habit-card component



src/app/(dashboard)/dashboard/habits/new/page.tsx is the create habit page that use habit-form component with createHabit action as prop



src/app/(dashboard)/dashboard/habits/[id]/page.tsx is the view habit 



src/app/(dashboard)/dashboard/habits/[id]/edit/page.tsx is the edit habit page that use habit-form component with updateHabit action as prop




Step 4: Daily Check-in Interface



â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      DAILY CHECK-IN SYSTEM                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚  Today's Habits                                     Jan 15, 2024â”‚       â”‚
â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚
â”‚  â”‚                                                                 â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  Morning Run                              â”Œâ”€â”€â”€â”€â”     â”‚       â”‚
â”‚  â”‚  â”‚  ğŸƒ  â”‚  ğŸ”¥ 5 day streak                          â”‚ âœ“  â”‚     â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜                                           â””â”€â”€â”€â”€â”˜     â”‚       â”‚
â”‚  â”‚                                                                 â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  Read 30 minutes                          â”Œâ”€â”€â”€â”€â”     â”‚       â”‚
â”‚  â”‚  â”‚  ğŸ“š  â”‚  ğŸ”¥ 12 day streak                         â”‚    â”‚     â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜                                           â””â”€â”€â”€â”€â”˜     â”‚       â”‚
â”‚  â”‚                                                                 â”‚       â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”  Meditate                                 â”Œâ”€â”€â”€â”€â”     â”‚       â”‚
â”‚  â”‚  â”‚  ğŸ§˜  â”‚  ğŸ”¥ 3 day streak                          â”‚ âœ“  â”‚     â”‚       â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”˜                                           â””â”€â”€â”€â”€â”˜     â”‚       â”‚
â”‚  â”‚                                                                 â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚                                                                             â”‚
â”‚  FEATURES:                                                                  â”‚
â”‚  âœ… One-click check-in                                                      â”‚
â”‚  âœ… Visual feedback (animation, color change)                               â”‚
â”‚  âœ… Optimistic updates (instant UI response)                                â”‚
â”‚  âœ… Undo capability (uncheck if mistake)                                    â”‚
â”‚  âœ… Date navigation (check past days)                                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜








src/
â”œâ”€â”€ app/
â”‚   â””â”€â”€ (dashboard)/
â”‚       â””â”€â”€ dashboard/
â”‚           â”œâ”€â”€ page.tsx                    # Updated with check-ins we add chek for habits
â”‚           â””â”€â”€ today/
â”‚               â””â”€â”€ page.tsx                # Dedicated check-in page  we add page for habit of this day
â”œâ”€â”€ components/
â”‚   â””â”€â”€ habits/
â”‚       â”œâ”€â”€ check-in-button.tsx             # The check button  
â”‚       â”œâ”€â”€ habit-check-in-card.tsx         # Habit with check-in
â”‚       â”œâ”€â”€ today-habits.tsx                # Today's habits list
â”‚       â””â”€â”€ date-navigator.tsx              # Navigate dates
â””â”€â”€ lib/
    â”œâ”€â”€ actions/
    â”‚   â””â”€â”€ habits.ts                       # Add check-in actions
    â””â”€â”€ utils/
        â””â”€â”€ date.ts                         # Date helper functions



src/lib/utils/date.ts=> is have this functions


export function getTodayDate(): string {}

export function formatDate(date: Date): string {}=>is for Format a Date object to YYYY-MM-DD string

export function parseDate(dateString: string): Date {}=>Parse a YYYY-MM-DD string to Date object


export function formatDateDisplay(dateString: string): string {}=> * Get a human-readable date string  * e.g., "Monday, January 15, 2024"


export function formatDateShort(dateString: string): string {}=> * Get a short date string  * e.g., "Jan 15"



export function isToday(dateString: string): boolean {}=> * Check if a date string is today


export function isPast(dateString: string): boolean {}=> * Check if a date string is in the past


export function isFuture(dateString: string): boolean {}=> * Check if a date string is in the future


export function getPreviousDay(dateString: string): string {}=> * Get the previous day


export function getNextDay(dateString: string): string {}=> * Get the next day

export function getLastNDays(n: number): string[] {}=> * Get an array of the last N days  * Useful for showing week view


export function getDayOfWeek(dateString: string): number {}=>* Get day of week (0 = Sunday, 1 = Monday, etc.)


export function getDayName(dateString: string): string {}=> * Get day name (short)



now we add function in (src/lib/actions/habits.ts) :


